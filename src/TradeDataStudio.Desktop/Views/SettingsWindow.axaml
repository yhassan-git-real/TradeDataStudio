<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="using:TradeDataStudio.Desktop.ViewModels"
        mc:Ignorable="d" d:DesignWidth="480" d:DesignHeight="420"
        x:Class="TradeDataStudio.Desktop.Views.SettingsWindow"
        x:DataType="vm:SettingsViewModel"
        Title="Database Settings"
        Icon="/Assets/avalonia-logo.ico"
        Width="480"
        Height="420"
        MinWidth="460"
        MinHeight="400"
        MaxWidth="500"
        MaxHeight="450"
        WindowStartupLocation="CenterOwner"
        CanResize="False"
        Background="#02111B">

    <Window.Styles>
        <Style Selector="Border.card">
            <Setter Property="Background" Value="#15052633"/>
            <Setter Property="BorderBrush" Value="{DynamicResource DefaultBorder}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="6"/>
            <Setter Property="Padding" Value="12"/>
        </Style>
        
        <Style Selector="TextBlock.header">
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Foreground" Value="{DynamicResource PrimaryText}"/>
            <Setter Property="Margin" Value="0,0,0,8"/>
        </Style>
        
        <Style Selector="TextBlock.label">
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="Foreground" Value="{DynamicResource SecondaryText}"/>
            <Setter Property="Margin" Value="0,0,0,4"/>
        </Style>
        
        <Style Selector="TextBox.input">
            <Setter Property="Padding" Value="8"/>
            <Setter Property="BorderBrush" Value="{DynamicResource DefaultBorder}"/>
            <Setter Property="Background" Value="#15052633"/>
            <Setter Property="Foreground" Value="{DynamicResource PrimaryText}"/>
            <Setter Property="CornerRadius" Value="4"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Height" Value="32"/>
        </Style>
        
        <Style Selector="TextBox.input:focus /template/ Border#PART_BorderElement">
            <Setter Property="BorderBrush" Value="{DynamicResource ElectricBlue}"/>
        </Style>
        
        <Style Selector="Button.primary">
            <Setter Property="Background" Value="#20064E5E"/>
            <Setter Property="BorderBrush" Value="{DynamicResource ElectricBlue}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Foreground" Value="{DynamicResource PrimaryText}"/>
            <Setter Property="CornerRadius" Value="4"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Height" Value="32"/>
        </Style>
        
        <Style Selector="Button.primary:pointerover">
            <Setter Property="Background" Value="#30083D4F"/>
        </Style>
        
        <Style Selector="Button.secondary">
            <Setter Property="Background" Value="#15052633"/>
            <Setter Property="Foreground" Value="{DynamicResource SecondaryText}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource DefaultBorder}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="4"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Height" Value="32"/>
        </Style>
        
        <Style Selector="Button.success">
            <Setter Property="Background" Value="#20064E5E"/>
            <Setter Property="BorderBrush" Value="{DynamicResource AzureBlue}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Foreground" Value="{DynamicResource PrimaryText}"/>
            <Setter Property="CornerRadius" Value="4"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Height" Value="32"/>
        </Style>
        
        <Style Selector="CheckBox.compact">
            <Setter Property="Foreground" Value="{DynamicResource PrimaryText}"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="Margin" Value="0,4"/>
        </Style>
        
        <!-- Status Message Styles -->
        <Style Selector="Border.status-message">
            <Setter Property="Background" Value="#15052633"/>
            <Setter Property="BorderBrush" Value="{DynamicResource ElectricBlue}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="4"/>
            <Setter Property="Padding" Value="10"/>
        </Style>
        
        <Style Selector="TextBlock.status-text">
            <Setter Property="TextWrapping" Value="Wrap"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="Foreground" Value="{DynamicResource PrimaryText}"/>
            <Setter Property="LineHeight" Value="18"/>
        </Style>
    </Window.Styles>

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Compact Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,12">
            <TextBlock Text="Database Settings" 
                       FontSize="16" 
                       FontWeight="Bold" 
                       Foreground="{DynamicResource PrimaryText}"/>
        </StackPanel>

        <!-- Main Content -->
        <ScrollViewer Grid.Row="1" Margin="0,0,0,12">
            <StackPanel Spacing="12">
                
                <!-- Server Configuration -->
                <Border Classes="card">
                    <StackPanel Spacing="8">
                        <TextBlock Text="Server Connection" Classes="header"/>
                        
                        <Grid ColumnDefinitions="1*,8,1*" RowDefinitions="Auto,Auto,Auto,Auto">
                            <StackPanel Grid.Column="0" Grid.Row="0">
                                <TextBlock Text="Server" Classes="label"/>
                                <TextBox Text="{Binding Server}" 
                                         Classes="input"
                                         Watermark="Server name"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Column="2" Grid.Row="0">
                                <TextBlock Text="Database" Classes="label"/>
                                <TextBox Text="{Binding Database}" 
                                         Classes="input"
                                         Watermark="Database name"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Column="0" Grid.Row="1" Grid.ColumnSpan="3" Margin="0,8,0,0">
                                <TextBlock Text="Connection Timeout" Classes="label"/>
                                <NumericUpDown Value="{Binding ConnectionTimeout}" 
                                               Minimum="5" 
                                               Maximum="300" 
                                               Increment="5"
                                               ShowButtonSpinner="True"
                                               FormatString="0 seconds"
                                               Background="#15052633"
                                               BorderBrush="{DynamicResource DefaultBorder}"
                                               Foreground="{DynamicResource PrimaryText}"
                                               CornerRadius="4"
                                               Height="32"
                                               FontSize="12"/>
                            </StackPanel>
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- Authentication -->
                <Border Classes="card">
                    <StackPanel Spacing="8">
                        <!-- Authentication Header with Toggle -->
                        <Grid ColumnDefinitions="*,Auto">
                            <TextBlock Grid.Column="0" 
                                      Text="Authentication" 
                                      Classes="header"
                                      VerticalAlignment="Center"/>
                            <Button Grid.Column="1"
                                    Command="{Binding ToggleAuthenticationCommand}"
                                    Background="Transparent"
                                    BorderThickness="0"
                                    Padding="4"
                                    CornerRadius="4"
                                    Height="24"
                                    Width="24"
                                    VerticalAlignment="Center"
                                    ToolTip.Tip="Toggle authentication settings">
                                <TextBlock FontSize="14"
                                          HorizontalAlignment="Center"
                                          VerticalAlignment="Center"
                                          Foreground="{DynamicResource SecondaryText}"
                                          Text="{Binding AuthenticationChevron}"/>
                            </Button>
                        </Grid>
                        
                        <!-- Authentication Content (Collapsible) -->
                        <StackPanel Spacing="8" IsVisible="{Binding IsAuthenticationExpanded}">
                            <CheckBox IsChecked="{Binding UseWindowsAuthentication}" 
                                      Classes="compact"
                                      Content="Use Windows Authentication"/>
                            
                            <CheckBox IsChecked="{Binding TrustServerCertificate}" 
                                      Classes="compact"
                                      Content="Trust Server Certificate"/>
                            
                            <StackPanel IsVisible="{Binding !UseWindowsAuthentication}" Spacing="6" Margin="0,4,0,0">
                                <Grid ColumnDefinitions="1*,8,1*">
                                    <StackPanel Grid.Column="0">
                                        <TextBlock Text="Username" Classes="label"/>
                                        <TextBox Text="{Binding Username}" 
                                                 Classes="input"
                                                 Watermark="Username"/>
                                    </StackPanel>
                                    
                                    <StackPanel Grid.Column="2">
                                        <TextBlock Text="Password" Classes="label"/>
                                        <TextBox Text="{Binding Password}" 
                                                 Classes="input"
                                                 PasswordChar="â—"
                                                 Watermark="Password"/>
                                    </StackPanel>
                                </Grid>
                            </StackPanel>
                        </StackPanel>
                    </StackPanel>
                </Border>

                <!-- Connection Test -->
                <Border Classes="card">
                    <StackPanel Spacing="8">
                        <TextBlock Text="Connection Test" Classes="header"/>
                        
                        <Button Command="{Binding TestConnectionCommand}"
                                IsEnabled="{Binding !IsTestingConnection}"
                                Classes="primary"
                                HorizontalAlignment="Stretch"
                                Content="Test Connection"/>
                        
                        <!-- Status Message -->
                        <Border Classes="status-message"
                                IsVisible="{Binding StatusMessage.Length}">
                            <TextBlock Classes="status-text"
                                       Text="{Binding StatusMessage}"/>
                        </Border>
                    </StackPanel>
                </Border>
                
            </StackPanel>
        </ScrollViewer>

        <!-- Action Buttons -->
        <Grid Grid.Row="2" ColumnDefinitions="*,Auto,Auto" Margin="0,12,0,0">
            <Button Grid.Column="1" 
                    Content="Cancel" 
                    Command="{Binding CancelCommand}"
                    Classes="secondary"
                    MinWidth="110"
                    Margin="0,0,12,0"/>
            <Button Grid.Column="2"
                    Content="Save Settings" 
                    Command="{Binding SaveCommand}"
                    Classes="success"
                    MinWidth="130"/>
        </Grid>
    </Grid>
</Window>
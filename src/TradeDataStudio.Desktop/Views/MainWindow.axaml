<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:TradeDataStudio.Desktop.ViewModels"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="1200" d:DesignHeight="700"
        x:Class="TradeDataStudio.Desktop.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Icon="/Assets/avalonia-logo.ico"
        Title="TradeData Studio"
        Width="1200" Height="700"
        MinWidth="800" MinHeight="550">

    <Design.DataContext>
        <!-- This only sets the DataContext for the previewer in an IDE,
             to set the actual DataContext for runtime, set the DataContext property in code (look at App.axaml.cs) -->
        <vm:MainWindowViewModel/>
    </Design.DataContext>

    <Window.Styles>
        <!-- Button Styling -->
        <Style Selector="Button">
            <Setter Property="Margin" Value="8"/>
            <Setter Property="Padding" Value="18,10"/>
            <Setter Property="MinWidth" Value="110"/>
            <Setter Property="Background" Value="#F8F9FA"/>
            <Setter Property="BorderBrush" Value="#E1E5E9"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="6"/>
            <Setter Property="Foreground" Value="#495057"/>
            <Setter Property="FontWeight" Value="Medium"/>
        </Style>
        <Style Selector="Button:pointerover">
            <Setter Property="Background" Value="#E9ECEF"/>
            <Setter Property="BorderBrush" Value="#CED4DA"/>
        </Style>
        <Style Selector="Button:pressed">
            <Setter Property="Background" Value="#DEE2E6"/>
        </Style>
        
        <!-- ComboBox Styling -->
        <Style Selector="ComboBox">
            <Setter Property="Margin" Value="8"/>
            <Setter Property="MinWidth" Value="220"/>
            <Setter Property="Background" Value="#FFFFFF"/>
            <Setter Property="BorderBrush" Value="#E1E5E9"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="6"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="Foreground" Value="#495057"/>
        </Style>
        <Style Selector="ComboBox:pointerover">
            <Setter Property="Background" Value="#F8F9FA"/>
            <Setter Property="BorderBrush" Value="#CED4DA"/>
        </Style>
        <Style Selector="ComboBox:focus">
            <Setter Property="BorderBrush" Value="#86B7FE"/>
        </Style>
        
        <!-- ComboBoxItem Styling -->
        <Style Selector="ComboBoxItem">
            <Setter Property="Background" Value="#FFFFFF"/>
            <Setter Property="Foreground" Value="#495057"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="MinHeight" Value="32"/>
            <Setter Property="BorderThickness" Value="0"/>
        </Style>
        <Style Selector="ComboBoxItem:pointerover">
            <Setter Property="Background" Value="#F8F9FA"/>
            <Setter Property="Foreground" Value="#495057"/>
        </Style>
        <Style Selector="ComboBoxItem:selected">
            <Setter Property="Background" Value="#E7F3FF"/>
            <Setter Property="Foreground" Value="#495057"/>
        </Style>
        <Style Selector="ComboBoxItem:selected:pointerover">
            <Setter Property="Background" Value="#D1ECFF"/>
            <Setter Property="Foreground" Value="#495057"/>
        </Style>
        
        <!-- TextBox Styling -->
        <Style Selector="TextBox">
            <Setter Property="Margin" Value="8"/>
            <Setter Property="MinWidth" Value="180"/>
            <Setter Property="Background" Value="#FFFFFF"/>
            <Setter Property="BorderBrush" Value="#E1E5E9"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="6"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="Foreground" Value="#495057"/>
        </Style>
        <Style Selector="TextBox:focus">
            <Setter Property="BorderBrush" Value="#86B7FE"/>
        </Style>
        
        <!-- TextBlock Styling -->
        <Style Selector="TextBlock">
            <Setter Property="Margin" Value="8,5,12,5"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Foreground" Value="#495057"/>
        </Style>
        <Style Selector="TextBlock.input-label">
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="#1F2933"/>
            <Setter Property="Margin" Value="0,0,0,8"/>
        </Style>
        <Style Selector="TextBlock.input-hint">
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="Foreground" Value="#94A3B8"/>
            <Setter Property="Margin" Value="0,6,0,0"/>
        </Style>
        
        <!-- Border Section Styling -->
        <Style Selector="Border.section">
            <Setter Property="Margin" Value="8"/>
            <Setter Property="Padding" Value="12"/>
            <Setter Property="Background" Value="#FFFFFF"/>
            <Setter Property="BorderBrush" Value="#E1E5E9"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="8"/>
        </Style>
        <Style Selector="Border.form-card">
            <Setter Property="Padding" Value="14"/>
            <Setter Property="Margin" Value="0,0,12,12"/>
            <Setter Property="Background" Value="#FFFFFF"/>
            <Setter Property="BorderBrush" Value="#E5E9F2"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="BoxShadow" Value="0 2 6 0 #0F172A1A"/>
            <Setter Property="HorizontalAlignment" Value="Stretch"/>
            <Setter Property="MaxWidth" Value="340"/>
            <Setter Property="MinWidth" Value="240"/>
        </Style>
        <Style Selector="Border.form-card-wide">
            <Setter Property="MaxWidth" Value="760"/>
            <Setter Property="HorizontalAlignment" Value="Stretch"/>
        </Style>
        <Style Selector="Border.icon-pill">
            <Setter Property="Width" Value="32"/>
            <Setter Property="Height" Value="32"/>
            <Setter Property="CornerRadius" Value="16"/>
            <Setter Property="Background" Value="#E0F2FE"/>
            <Setter Property="HorizontalAlignment" Value="Center"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Padding" Value="0"/>
        </Style>
        <Style Selector="TextBlock.icon-glyph">
            <Setter Property="HorizontalAlignment" Value="Center"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Foreground" Value="#1E3A8A"/>
            <Setter Property="Margin" Value="0"/>
        </Style>
        
        <!-- Section Header Styling -->
        <Style Selector="TextBlock.section-header">
            <Setter Property="FontSize" Value="15"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="#2C3E50"/>
            <Setter Property="Margin" Value="0,0,0,8"/>
        </Style>
        
        <!-- Button Styling -->
        <Style Selector="Button">
            <Setter Property="Margin" Value="6,4"/>
            <Setter Property="MinWidth" Value="100"/>
            <Setter Property="Background" Value="#3498DB"/>
            <Setter Property="BorderBrush" Value="#2980B9"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="6"/>
            <Setter Property="Padding" Value="16,10"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>
        
        <!-- Primary Button -->
        <Style Selector="Button.primary-button">
            <Setter Property="Background" Value="#28A745"/>
            <Setter Property="BorderBrush" Value="#218838"/>
        </Style>
        <Style Selector="Button.primary-button:pointerover">
            <Setter Property="Background" Value="#218838"/>
            <Setter Property="BorderBrush" Value="#1E7E34"/>
        </Style>
        
        <!-- Secondary Button -->
        <Style Selector="Button.secondary-button">
            <Setter Property="Background" Value="#6C757D"/>
            <Setter Property="BorderBrush" Value="#5A6268"/>
        </Style>
        <Style Selector="Button.secondary-button:pointerover">
            <Setter Property="Background" Value="#5A6268"/>
            <Setter Property="BorderBrush" Value="#545B62"/>
        </Style>
        
        <!-- Success Button -->
        <Style Selector="Button.success-button">
            <Setter Property="Background" Value="#17A2B8"/>
            <Setter Property="BorderBrush" Value="#138496"/>
        </Style>
        <Style Selector="Button.success-button:pointerover">
            <Setter Property="Background" Value="#138496"/>
            <Setter Property="BorderBrush" Value="#117A8B"/>
        </Style>
        
        <Style Selector="Button:pointerover">
            <Setter Property="Background" Value="#2980B9"/>
            <Setter Property="BorderBrush" Value="#21618C"/>
            <Setter Property="RenderTransform" Value="scale(1.02)"/>
        </Style>
        <Style Selector="Button:pressed">
            <Setter Property="RenderTransform" Value="scale(0.98)"/>
        </Style>

        <!-- Action button palette -->
        <Style Selector="Button.action-button">
            <Setter Property="Background" Value="#EEF2FF"/>
            <Setter Property="BorderBrush" Value="#CBD5F5"/>
            <Setter Property="Foreground" Value="#1E3A8A"/>
        </Style>
        <Style Selector="Button.action-button:disabled">
            <Setter Property="Background" Value="#EEF2FF"/>
            <Setter Property="Foreground" Value="#94A3B8"/>
            <Setter Property="BorderBrush" Value="#E2E8F0"/>
            <Setter Property="Opacity" Value="0.75"/>
        </Style>
        <Style Selector="Button.action-button.primary">
            <Setter Property="Background" Value="#2563EB"/>
            <Setter Property="BorderBrush" Value="#1D4ED8"/>
            <Setter Property="Foreground" Value="White"/>
        </Style>
        <Style Selector="Button.action-button.primary:pointerover">
            <Setter Property="Background" Value="#1E40AF"/>
            <Setter Property="BorderBrush" Value="#1C3D9F"/>
        </Style>
        <Style Selector="Button.action-button.success">
            <Setter Property="Background" Value="#16A34A"/>
            <Setter Property="BorderBrush" Value="#15803D"/>
            <Setter Property="Foreground" Value="White"/>
        </Style>
        <Style Selector="Button.action-button.success:pointerover">
            <Setter Property="Background" Value="#0F7A32"/>
            <Setter Property="BorderBrush" Value="#0C6B2A"/>
        </Style>
        <Style Selector="Button.action-button.neutral">
            <Setter Property="Background" Value="#F8FAFC"/>
            <Setter Property="BorderBrush" Value="#D7E3FC"/>
            <Setter Property="Foreground" Value="#0F172A"/>
        </Style>
        <Style Selector="Button.action-button.neutral:pointerover">
            <Setter Property="Background" Value="#EFF6FF"/>
            <Setter Property="BorderBrush" Value="#BFDBFE"/>
        </Style>
        
        <!-- Tooltip Styling -->
        <Style Selector="ToolTip">
            <Setter Property="Background" Value="#2C3E50"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="8,6"/>
            <Setter Property="CornerRadius" Value="4"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="MaxWidth" Value="300"/>
        </Style>
        
        <!-- RadioButton Styling -->
        <Style Selector="RadioButton">
            <Setter Property="Margin" Value="8"/>
            <Setter Property="Foreground" Value="#495057"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="FontSize" Value="14"/>
        </Style>
        <Style Selector="RadioButton:pointerover">
            <Setter Property="Foreground" Value="#667EEA"/>
        </Style>
        <Style Selector="RadioButton:checked">
            <Setter Property="Foreground" Value="#667EEA"/>
        </Style>
        
        <!-- Modern Header Styling -->
        <Style Selector="Border.modern-header">
            <Setter Property="Background">
                <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                    <GradientStop Color="#FAFBFC" Offset="0.0"/>
                    <GradientStop Color="#F5F7FA" Offset="1.0"/>
                </LinearGradientBrush>
            </Setter>
            <Setter Property="BorderBrush" Value="#E2E8F0"/>
            <Setter Property="BorderThickness" Value="0,0,0,2"/>
            <Setter Property="Height" Value="85"/>
        </Style>
        
        <!-- App Title Styling -->
        <Style Selector="TextBlock.app-title">
            <Setter Property="FontSize" Value="20"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="#1A202C"/>
        </Style>
        
        <Style Selector="TextBlock.app-subtitle">
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Foreground" Value="#64748B"/>
            <Setter Property="FontWeight" Value="Medium"/>
        </Style>
        
        <Style Selector="TextBlock.version-badge">
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="#059669"/>
        </Style>
        
        <Style Selector="Border.version-badge">
            <Setter Property="Background" Value="#D1FAE5"/>
            <Setter Property="Padding" Value="8,3"/>
            <Setter Property="CornerRadius" Value="12"/>
        </Style>
        
        <!-- Footer Styling -->
        <Style Selector="Border.footer">
            <Setter Property="Background" Value="#F8F9FA"/>
            <Setter Property="BorderBrush" Value="#E1E5E9"/>
            <Setter Property="BorderThickness" Value="0,1,0,0"/>
            <Setter Property="Height" Value="50"/>
        </Style>
    </Window.Styles>

    <Grid>
        <DockPanel>
            <!-- Menu Bar -->
            <Menu DockPanel.Dock="Top" Background="#FFFFFF" BorderBrush="#E2E8F0" BorderThickness="0,0,0,1" Height="28">
                <MenuItem Header="_File">
                    <MenuItem Header="_New Project" Command="{Binding ResetCommand}" InputGesture="Ctrl+N">
                        <MenuItem.Icon>
                            <TextBlock Text="ðŸ“„" FontSize="14"/>
                        </MenuItem.Icon>
                    </MenuItem>
                    <Separator/>
                    <MenuItem Header="_Settings" Command="{Binding SettingsCommand}" InputGesture="Ctrl+,">
                        <MenuItem.Icon>
                            <TextBlock Text="âš™ï¸" FontSize="14"/>
                        </MenuItem.Icon>
                    </MenuItem>
                    <Separator/>
                    <MenuItem Header="E_xit" Command="{Binding ExitCommand}" InputGesture="Alt+F4">
                        <MenuItem.Icon>
                            <TextBlock Text="âŒ" FontSize="14"/>
                        </MenuItem.Icon>
                    </MenuItem>
                </MenuItem>
                
                <MenuItem Header="_Edit">
                    <MenuItem Header="_Reset Form" Command="{Binding ResetCommand}" InputGesture="Ctrl+R">
                        <MenuItem.Icon>
                            <TextBlock Text="ðŸ”„" FontSize="14"/>
                        </MenuItem.Icon>
                    </MenuItem>
                    <Separator/>
                    <MenuItem Header="_Copy Output Location" Command="{Binding CopyOutputLocationCommand}" InputGesture="Ctrl+C">
                        <MenuItem.Icon>
                            <TextBlock Text="ðŸ“‹" FontSize="14"/>
                        </MenuItem.Icon>
                    </MenuItem>
                </MenuItem>
                
                <MenuItem Header="_View">
                    <MenuItem Header="View _Logs" Command="{Binding ViewLogsCommand}" InputGesture="Ctrl+L">
                        <MenuItem.Icon>
                            <TextBlock Text="ðŸ“‹" FontSize="14"/>
                        </MenuItem.Icon>
                    </MenuItem>
                    <MenuItem Header="_Refresh" Command="{Binding RefreshCommand}" InputGesture="F5">
                        <MenuItem.Icon>
                            <TextBlock Text="ðŸ”„" FontSize="14"/>
                        </MenuItem.Icon>
                    </MenuItem>
                </MenuItem>
                
                <MenuItem Header="_Settings">
                    <MenuItem Header="Database _Settings" Command="{Binding SettingsCommand}" InputGesture="Ctrl+,">
                        <MenuItem.Icon>
                            <TextBlock Text="âš™ï¸" FontSize="14"/>
                        </MenuItem.Icon>
                    </MenuItem>
                </MenuItem>
                
                <MenuItem Header="_Help">
                    <MenuItem Header="_User Guide" Command="{Binding ShowUserGuideCommand}" InputGesture="F1">
                        <MenuItem.Icon>
                            <TextBlock Text="ðŸ“–" FontSize="14"/>
                        </MenuItem.Icon>
                    </MenuItem>
                    <MenuItem Header="_Keyboard Shortcuts" Command="{Binding ShowShortcutsCommand}">
                        <MenuItem.Icon>
                            <TextBlock Text="âŒ¨ï¸" FontSize="14"/>
                        </MenuItem.Icon>
                    </MenuItem>
                    <Separator/>
                    <MenuItem Header="_About TradeData Studio" Command="{Binding ShowAboutCommand}">
                        <MenuItem.Icon>
                            <TextBlock Text="â„¹ï¸" FontSize="14"/>
                        </MenuItem.Icon>
                    </MenuItem>
                </MenuItem>
            </Menu>
        
        <!-- Footer with Connection Status -->
        <Border DockPanel.Dock="Bottom" Classes="footer">
            <Grid ColumnDefinitions="Auto,*,Auto">
                <!-- Left: Connection Info -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="16" Margin="20,8">
                    <StackPanel Orientation="Horizontal" Spacing="6">
                        <Ellipse Width="8" Height="8" 
                                Fill="#22C55E"
                                VerticalAlignment="Center"/>
                        <TextBlock Text="{Binding ConnectionStatus}" 
                                   FontSize="12" 
                                   FontWeight="Medium" 
                                   VerticalAlignment="Center"/>
                    </StackPanel>
                    
                    <StackPanel Orientation="Horizontal" Spacing="4" 
                               IsVisible="{Binding ConnectedServer.Length}">
                        <TextBlock Text="Server:" FontSize="11" Foreground="#64748B"/>
                        <TextBlock Text="{Binding ConnectedServer}" FontSize="11" FontWeight="Medium"/>
                    </StackPanel>
                    
                    <StackPanel Orientation="Horizontal" Spacing="4"
                               IsVisible="{Binding ConnectedDatabase.Length}">
                        <TextBlock Text="DB:" FontSize="11" Foreground="#64748B"/>
                        <TextBlock Text="{Binding ConnectedDatabase}" FontSize="11" FontWeight="Medium"/>
                    </StackPanel>
                    
                    <StackPanel Orientation="Horizontal" Spacing="4"
                               IsVisible="{Binding ConnectedUser.Length}">
                        <TextBlock Text="User:" FontSize="11" Foreground="#64748B"/>
                        <TextBlock Text="{Binding ConnectedUser}" FontSize="11" FontWeight="Medium"/>
                    </StackPanel>
                </StackPanel>
                
                <!-- Center: Status Message -->
                <TextBlock Grid.Column="1" 
                           Text="{Binding StatusMessage}" 
                           VerticalAlignment="Center" 
                           HorizontalAlignment="Center"
                           FontSize="12"
                           Foreground="#6C757D"/>
                           
                <!-- Right: App Info, Version and Status -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center" Spacing="12" Margin="20,8">
                    <!-- Application Status -->
                    <StackPanel Orientation="Horizontal" Spacing="6">
                        <Ellipse Width="8" Height="8" Fill="#10B981" VerticalAlignment="Center"/>
                        <TextBlock Text="Ready" FontSize="12" Foreground="#374151" FontWeight="Medium" VerticalAlignment="Center"/>
                    </StackPanel>
                    
                    <!-- Version Badge -->
                    <Border Background="#F0FDF4" BorderBrush="#BBF7D0" BorderThickness="1" CornerRadius="6" Padding="8,4">
                        <TextBlock Text="v1.0.0" FontSize="11" FontWeight="SemiBold" Foreground="#059669"/>
                    </Border>
                    
                    <!-- Application Name -->
                    <TextBlock Text="TradeData Studio" 
                              FontSize="11" 
                              Foreground="#64748B" 
                              FontWeight="Medium"
                              VerticalAlignment="Center"/>
                </StackPanel>
            </Grid>
        </Border>
        
        <!-- Main Content with Gradient Background -->
        <Border>
            <Border.Background>
                <VisualBrush TileMode="Tile" SourceRect="0,0,50,50" DestinationRect="0,0,50,50" Stretch="None">
                    <VisualBrush.Visual>
                        <Canvas Width="50" Height="50" Background="#FFFFFF">
                            <Rectangle Width="50" Height="1" Fill="#3B82F60D" Canvas.Top="0"/>
                            <Rectangle Width="1" Height="50" Fill="#3B82F60D" Canvas.Left="0"/>
                        </Canvas>
                    </VisualBrush.Visual>
                </VisualBrush>
            </Border.Background>
            
            <ScrollViewer ClipToBounds="False">
                <StackPanel Margin="12,6">
                    <!-- Main Configuration Card - Modern Two-Column Design -->
                        <Border Background="#FFFFFF"
                            BorderBrush="#E1E4E8"
                            BorderThickness="1"
                            CornerRadius="8"
                            Padding="18"
                            Margin="4,4,4,8"
                            BoxShadow="0 2 8 0 #0000000D">
                        <StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,8" VerticalAlignment="Center" Spacing="10">
                                <Border Width="34" Height="34" CornerRadius="17" Background="#E0F2FE" VerticalAlignment="Center">
                                    <TextBlock Text="âš™" HorizontalAlignment="Center" VerticalAlignment="Center" FontSize="15" Foreground="#0F609B"/>
                                </Border>
                                <StackPanel>
                                    <TextBlock Text="Configuration" 
                                               FontSize="18" 
                                               FontWeight="SemiBold" 
                                               Foreground="#111827"/>
                                    <TextBlock Text="Set up the operation, output, and export details." 
                                               FontSize="12" 
                                               Foreground="#6B7280"/>
                                </StackPanel>
                            </StackPanel>
                            <Border Height="1" Background="#E5E7EB" Margin="0,0,0,16"/>
                            
                            <!-- Compact, colorful card grid -->
                            <StackPanel>
                                <Grid Margin="0,0,0,8" ColumnDefinitions="Auto,Auto,Auto,Auto" RowDefinitions="Auto,Auto">
                                    <Grid.Styles>
                                        <Style Selector="Border.form-card">
                                            <Setter Property="Margin" Value="0,0,12,12"/>
                                        </Style>
                                    </Grid.Styles>
                                    <!-- Operation -->
                                    <Border Classes="form-card" ZIndex="10" Grid.Column="0" Grid.Row="0">
                                        <StackPanel Spacing="12">
                                            <StackPanel Orientation="Horizontal" Spacing="8">
                                                <Border Classes="icon-pill" Background="#E0F2FE">
                                                    <TextBlock Text="â‡…" Classes="icon-glyph"/>
                                                </Border>
                                                <StackPanel>
                                                    <TextBlock Text="Operation Mode" Classes="input-label"/>
                                                    <TextBlock Text="Choose how the procedure should run." Classes="input-hint"/>
                                                </StackPanel>
                                            </StackPanel>
                                            <StackPanel Orientation="Horizontal" Spacing="16">
                                                <RadioButton x:Name="ExportModeRadio"
                                                             Content="Export"
                                                             Margin="0"
                                                             IsChecked="{Binding IsExportMode}"
                                                             GroupName="OperationMode"
                                                             FontSize="13"/>
                                                <RadioButton x:Name="ImportModeRadio"
                                                             Content="Import"
                                                             Margin="0"
                                                             IsChecked="{Binding IsImportMode}"
                                                             GroupName="OperationMode"
                                                             FontSize="13"/>
                                            </StackPanel>
                                        </StackPanel>
                                    </Border>

                                    <!-- Stored Procedure -->
                                    <Border Classes="form-card" ZIndex="100" Grid.Column="1" Grid.Row="0">
                                        <StackPanel Spacing="12">
                                            <StackPanel Orientation="Horizontal" Spacing="8">
                                                <Border Classes="icon-pill" Background="#FEE2E2">
                                                    <TextBlock Text="âš™" Classes="icon-glyph" Foreground="#B91C1C"/>
                                                </Border>
                                                <StackPanel>
                                                    <TextBlock Text="Stored Procedure" Classes="input-label"/>
                                                    <TextBlock Text="Sorted alphabetically for quicker scanning." Classes="input-hint"/>
                                                    <TextBlock FontSize="10" Foreground="#22C55E" Margin="0,4,0,0">
                                                        <TextBlock.Text>
                                                            <MultiBinding StringFormat="Loaded: {0} procedures">
                                                                <Binding Path="AvailableStoredProcedures.Count"/>
                                                            </MultiBinding>
                                                        </TextBlock.Text>
                                                    </TextBlock>
                                                </StackPanel>
                                            </StackPanel>
                                            <ComboBox x:Name="StoredProcedureDropdown"
                                                      ItemsSource="{Binding AvailableStoredProcedures}"
                                                      SelectedItem="{Binding SelectedStoredProcedure}"
                                                      PlaceholderText="Select procedure..."
                                                      FontSize="13"
                                                      Margin="0"
                                                      HorizontalAlignment="Stretch"
                                                      MaxDropDownHeight="300"
                                                      IsEnabled="True"
                                                      ToolTip.Tip="Choose the stored procedure to execute">
                                                <ComboBox.ItemTemplate>
                                                    <DataTemplate>
                                                        <TextBlock Text="{Binding DisplayName}" FontSize="13"/>
                                                    </DataTemplate>
                                                </ComboBox.ItemTemplate>
                                            </ComboBox>
                                        </StackPanel>
                                    </Border>

                                    <!-- Output Tables -->
                                    <Border Classes="form-card" ZIndex="50" Grid.Column="2" Grid.Row="0">
                                        <StackPanel Spacing="12">
                                            <StackPanel Orientation="Horizontal" Spacing="8">
                                                <Border Classes="icon-pill" Background="#E0E7FF">
                                                    <TextBlock Text="ðŸ—‚" Classes="icon-glyph" Foreground="#3730A3"/>
                                                </Border>
                                                <StackPanel>
                                                    <TextBlock Text="Output Tables" Classes="input-label"/>
                                                    <TextBlock Text="Pick one or multiple tables from the popup." Classes="input-hint"/>
                                                </StackPanel>
                                            </StackPanel>
                                            <Button x:Name="SelectTablesButton"
                                                    Content="Select Tables..."
                                                    Margin="0"
                                                    Command="{Binding ShowTableSelectionPopupCommand}"
                                                    FontSize="13"
                                                    MinWidth="140"
                                                    HorizontalAlignment="Left"
                                                    ToolTip.Tip="Click to select tables to export"/>
                                        </StackPanel>
                                    </Border>

                                    <!-- File Format -->
                                    <Border Classes="form-card" ZIndex="90" Grid.Column="3" Grid.Row="0">
                                        <StackPanel Spacing="12">
                                            <StackPanel Orientation="Horizontal" Spacing="8">
                                                <Border Classes="icon-pill" Background="#DCFCE7">
                                                    <TextBlock Text="ðŸ§¾" Classes="icon-glyph" Foreground="#15803D"/>
                                                </Border>
                                                <StackPanel>
                                                    <TextBlock Text="File Format" Classes="input-label"/>
                                                    <TextBlock Text="Applies to all selected exports." Classes="input-hint"/>
                                                </StackPanel>
                                            </StackPanel>
                                            <ComboBox x:Name="FormatDropdown"
                                                      ItemsSource="{Binding AvailableExportFormats}"
                                                      SelectedItem="{Binding SelectedExportFormat}"
                                                      FontSize="13"
                                                      Width="200"
                                                      Margin="0"
                                                      HorizontalAlignment="Left"
                                                      ToolTip.Tip="Choose export format"/>
                                        </StackPanel>
                                    </Border>
                                </Grid>

                                <Grid Margin="0" ColumnDefinitions="Auto,Auto" RowDefinitions="Auto">
                                    <!-- Parameters -->
                                    <Border Classes="form-card form-card-wide" ZIndex="5" Grid.Column="0" Grid.Row="0">
                                        <StackPanel Spacing="12">
                                            <StackPanel Orientation="Horizontal" Spacing="8">
                                                <Border Classes="icon-pill" Background="#DBEAFE">
                                                    <TextBlock Text="ðŸ“…" Classes="icon-glyph" Foreground="#1D4ED8"/>
                                                </Border>
                                                <StackPanel>
                                                    <TextBlock Text="Parameters" Classes="input-label"/>
                                                    <TextBlock Text="Enter start and end periods (YYYYMM)." Classes="input-hint"/>
                                                </StackPanel>
                                            </StackPanel>
                                            <Grid ColumnDefinitions="200,24,200">
                                                <StackPanel Grid.Column="0" Spacing="4">
                                                    <TextBlock Text="Start Period" FontSize="12" Foreground="#4B5563" Margin="0,0,0,4"/>
                                                    <TextBox x:Name="StartPeriodBox"
                                                             Text="{Binding StartPeriod}"
                                                             Watermark="YYYYMM"
                                                             FontSize="13"
                                                             Width="200"
                                                             Margin="0"
                                                             ToolTip.Tip="Enter start period (e.g., 202411 for November 2024)"/>
                                                </StackPanel>
                                                <StackPanel Grid.Column="2" Spacing="4">
                                                    <TextBlock Text="End Period" FontSize="12" Foreground="#4B5563" Margin="0,0,0,4"/>
                                                    <TextBox x:Name="EndPeriodBox"
                                                             Text="{Binding EndPeriod}"
                                                             Watermark="YYYYMM"
                                                             FontSize="13"
                                                             Width="200"
                                                             Margin="0"
                                                             ToolTip.Tip="Enter end period (e.g., 202411 for November 2024)"/>
                                                </StackPanel>
                                            </Grid>
                                            <TextBlock Text="Format: YYYYMM (e.g., 202411 for November 2024)" Classes="input-hint"/>
                                        </StackPanel>
                                    </Border>

                                    <!-- Output Location (Export Mode) -->
                                    <Border Classes="form-card form-card-wide" IsVisible="{Binding IsExportMode}" ZIndex="5" Grid.Column="1" Grid.Row="0">
                                        <StackPanel Spacing="12">
                                            <StackPanel Orientation="Horizontal" Spacing="8">
                                                <Border Classes="icon-pill" Background="#FEF9C3">
                                                    <TextBlock Text="ðŸ“" Classes="icon-glyph" Foreground="#B45309"/>
                                                </Border>
                                                <StackPanel>
                                                    <TextBlock Text="Output Location" Classes="input-label"/>
                                                    <TextBlock Text="Choose a destination or use the default export path." Classes="input-hint"/>
                                                </StackPanel>
                                            </StackPanel>
                                            <CheckBox Content="Use custom output location"
                                                      IsChecked="{Binding UseCustomLocation}"
                                                      FontSize="13"/>
                                            <Grid IsVisible="{Binding UseCustomLocation}" ColumnDefinitions="340,Auto">
                                                <TextBox Grid.Column="0"
                                                         Text="{Binding CustomOutputLocation}"
                                                         Watermark="Enter folder path..."
                                                         FontSize="13"
                                                         Margin="0,0,12,0"/>
                                                <Button Grid.Column="1"
                                                        Content="Browse"
                                                        Margin="0"
                                                        Command="{Binding BrowseOutputLocationCommand}"
                                                        FontSize="13"
                                                        MinWidth="90"
                                                        ToolTip.Tip="Browse for output folder"/>
                                            </Grid>
                                            <TextBlock Text="Default: exports/export" Classes="input-hint" IsVisible="{Binding !UseCustomLocation}"/>
                                        </StackPanel>
                                    </Border>
                                    
                                    <!-- Output Location (Import Mode) -->
                                    <Border Classes="form-card form-card-wide" IsVisible="{Binding IsImportMode}" ZIndex="5" Grid.Column="1" Grid.Row="0">
                                        <StackPanel Spacing="12">
                                            <StackPanel Orientation="Horizontal" Spacing="8">
                                                <Border Classes="icon-pill" Background="#FEF9C3">
                                                    <TextBlock Text="ðŸ“" Classes="icon-glyph" Foreground="#B45309"/>
                                                </Border>
                                                <StackPanel>
                                                    <TextBlock Text="Output Location" Classes="input-label"/>
                                                    <TextBlock Text="Choose a destination or use the default export path." Classes="input-hint"/>
                                                </StackPanel>
                                            </StackPanel>
                                            <CheckBox Content="Use custom output location"
                                                      IsChecked="{Binding UseCustomLocation}"
                                                      FontSize="13"/>
                                            <Grid IsVisible="{Binding UseCustomLocation}" ColumnDefinitions="340,Auto">
                                                <TextBox Grid.Column="0"
                                                         Text="{Binding CustomOutputLocation}"
                                                         Watermark="Enter folder path..."
                                                         FontSize="13"
                                                         Margin="0,0,12,0"/>
                                                <Button Grid.Column="1"
                                                        Content="Browse"
                                                        Margin="0"
                                                        Command="{Binding BrowseOutputLocationCommand}"
                                                        FontSize="13"
                                                        MinWidth="90"
                                                        ToolTip.Tip="Browse for output folder"/>
                                            </Grid>
                                            <TextBlock Text="Default: exports/export" Classes="input-hint" IsVisible="{Binding !UseCustomLocation}"/>
                                        </StackPanel>
                                    </Border>
                                </Grid>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <!-- Actions -->
                    <Border Background="#FFFFFF"
                            BorderBrush="#E1E4E8"
                            BorderThickness="1"
                            CornerRadius="8"
                            Padding="16"
                            Margin="4,4,4,6"
                            BoxShadow="0 2 8 0 #0000000D">
                        <StackPanel Spacing="8">
                            <TextBlock Text="Actions" 
                                       FontSize="14" 
                                       FontWeight="SemiBold" 
                                       Foreground="#586069"/>
                            <!-- Button bar -->
                            <WrapPanel ItemWidth="140" MinWidth="320">
                                <Button x:Name="ExecuteButton"
                                        Content="Execute" 
                                        Command="{Binding ExecuteCommand}"
                                        ToolTip.Tip="Execute the selected stored procedure (Ctrl+E)"
                                        HotKey="Ctrl+E"
                                    Classes="action-button primary"
                                        Padding="12,8"
                                        MinWidth="130"
                                        Height="32"
                                        CornerRadius="6"
                                        FontSize="12"
                                        FontWeight="Medium"
                                        Margin="0,0,10,8">
                                </Button>
                                <Button x:Name="ExportButton"
                                        Content="Download" 
                                        Command="{Binding ExportCommand}" 
                                        ToolTip.Tip="Download selected table to chosen format (Ctrl+X)"
                                        HotKey="Ctrl+X"
                                    Classes="action-button"
                                        Padding="12,8"
                                        MinWidth="130"
                                        Height="32"
                                        CornerRadius="6"
                                        FontSize="12"
                                        FontWeight="Medium"
                                        Margin="0,0,10,8">
                                </Button>
                                <Button x:Name="StartButton"
                                        Content="Start" 
                                        Command="{Binding StartCommand}"
                                        ToolTip.Tip="Execute procedure and auto-export all output tables (Ctrl+S)"
                                        HotKey="Ctrl+S"
                                    Classes="action-button success"
                                        Padding="12,8"
                                        MinWidth="130"
                                        Height="32"
                                        CornerRadius="6"
                                        FontSize="12"
                                        FontWeight="Medium"
                                        Margin="0,0,10,8">
                                </Button>
                                <Button x:Name="StopButton"
                                        Content="Stop" 
                                        Command="{Binding StopCommand}"
                                        ToolTip.Tip="Cancel current operation (Ctrl+Q)"
                                        HotKey="Ctrl+Q"
                                        Background="#DC2626"
                                        BorderBrush="#B91C1C"
                                        Padding="12,8"
                                        MinWidth="130"
                                        Height="32"
                                        CornerRadius="6"
                                        FontSize="12"
                                        FontWeight="Medium"
                                        Margin="0,0,10,8">
                                </Button>
                                <Button x:Name="ResetButton"
                                        Content="Reset" 
                                        Command="{Binding ResetCommand}"
                                        ToolTip.Tip="Clear all selections and reset form (Ctrl+R)"
                                        HotKey="Ctrl+R"
                                    Classes="action-button neutral"
                                        Padding="12,8"
                                        MinWidth="130"
                                        Height="32"
                                        CornerRadius="6"
                                        FontSize="12"
                                        FontWeight="Medium"
                                        Margin="0,0,10,8">
                                </Button>
                                <Button x:Name="ViewLogsButton"
                                        Content="View Logs" 
                                        Command="{Binding ViewLogsCommand}"
                                        ToolTip.Tip="Open application logs (Ctrl+L)"
                                        HotKey="Ctrl+L"
                                    Classes="action-button neutral"
                                        Padding="12,8"
                                        MinWidth="130"
                                        Height="32"
                                        CornerRadius="6"
                                        FontSize="12"
                                        FontWeight="Medium"
                                        Margin="0,0,10,8">
                                </Button>
                            </WrapPanel>
                        </StackPanel>
                    </Border>

                    <!-- Recent Activity -->
                    <Border Background="#FFFFFF"
                            BorderBrush="#E1E4E8"
                            BorderThickness="1"
                            CornerRadius="8"
                            Padding="16"
                            Margin="4,0,4,8"
                            BoxShadow="0 2 8 0 #0000000D">
                        <StackPanel>
                            <TextBlock Text="Recent Activity" 
                                       FontSize="15" 
                                       FontWeight="SemiBold" 
                                       Foreground="#24292E" 
                                       Margin="0,0,0,10"/>
                            
                            <!-- Live Operation Status -->
                            <Border IsVisible="{Binding IsOperationInProgress}"
                                    Background="#FFF3CD"
                                    BorderBrush="#FFC107"
                                    BorderThickness="1.5"
                                    CornerRadius="6"
                                    Padding="12,8"
                                    Margin="0,0,0,10">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <TextBlock Text="â—" 
                                               FontSize="14" 
                                               Foreground="#FF9800"
                                               FontWeight="Bold"
                                               VerticalAlignment="Center">
                                        <TextBlock.Styles>
                                            <Style Selector="TextBlock">
                                                <Style.Animations>
                                                    <Animation Duration="0:0:1" IterationCount="Infinite">
                                                        <KeyFrame Cue="0%">
                                                            <Setter Property="Opacity" Value="1.0"/>
                                                        </KeyFrame>
                                                        <KeyFrame Cue="50%">
                                                            <Setter Property="Opacity" Value="0.3"/>
                                                        </KeyFrame>
                                                        <KeyFrame Cue="100%">
                                                            <Setter Property="Opacity" Value="1.0"/>
                                                        </KeyFrame>
                                                    </Animation>
                                                </Style.Animations>
                                            </Style>
                                        </TextBlock.Styles>
                                    </TextBlock>
                                    <TextBlock Text="{Binding CurrentOperationStatus}" 
                                               FontSize="13" 
                                               FontWeight="SemiBold"
                                               Foreground="#856404"
                                               VerticalAlignment="Center"/>
                                </StackPanel>
                            </Border>
                            
                            <ScrollViewer Height="250" VerticalScrollBarVisibility="Auto">
                                <Border CornerRadius="6" Background="#FFFFFF" BorderBrush="#D0D7DE" BorderThickness="1.5">
                                    <StackPanel>
                                        <!-- Table Header - Always Visible -->
                                        <Border Background="#F6F8FA" BorderBrush="#D0D7DE" BorderThickness="0,0,0,2" Padding="10,10">
                                            <Grid ColumnDefinitions="100,70,50,*">
                                                <!-- Vertical separators in header -->
                                                <Border Grid.Column="0" BorderBrush="#D0D7DE" BorderThickness="0,0,1,0" Padding="0,0,10,0">
                                                    <TextBlock Text="Time" FontFamily="Consolas" FontSize="13" FontWeight="Bold" Foreground="#24292E"/>
                                                </Border>
                                                <Border Grid.Column="1" BorderBrush="#D0D7DE" BorderThickness="0,0,1,0" Padding="10,0,10,0">
                                                    <TextBlock Text="Mode" FontFamily="Consolas" FontSize="13" FontWeight="Bold" Foreground="#24292E"/>
                                                </Border>
                                                <Border Grid.Column="2" BorderBrush="#D0D7DE" BorderThickness="0,0,1,0" Padding="10,0,10,0">
                                                    <TextBlock Text="Status" FontFamily="Consolas" FontSize="13" FontWeight="Bold" Foreground="#24292E"/>
                                                </Border>
                                                <Border Grid.Column="3" Padding="10,0,0,0">
                                                    <TextBlock Text="Operation Details" FontFamily="Consolas" FontSize="13" FontWeight="Bold" Foreground="#24292E"/>
                                                </Border>
                                            </Grid>
                                        </Border>
                                        
                                        <!-- Table Rows -->
                                        <ItemsControl ItemsSource="{Binding ActivityLogs}">
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate>
                                                    <Border BorderBrush="#D0D7DE" BorderThickness="0,0,0,1.5" Padding="10,8" Background="#FFFFFF">
                                                        <Grid ColumnDefinitions="100,70,50,*">
                                                            <!-- Vertical separators -->
                                                            <Border Grid.Column="0" BorderBrush="#E1E4E8" BorderThickness="0,0,1,0" Padding="0,0,10,0">
                                                                <TextBlock Text="{Binding Time}" FontFamily="Consolas" FontSize="12" FontWeight="Medium" Foreground="#24292F"/>
                                                            </Border>
                                                            <Border Grid.Column="1" BorderBrush="#E1E4E8" BorderThickness="0,0,1,0" Padding="10,0,10,0">
                                                                <TextBlock Text="{Binding Mode}" FontFamily="Consolas" FontSize="12" FontWeight="SemiBold" Foreground="#0969DA"/>
                                                            </Border>
                                                            <Border Grid.Column="2" BorderBrush="#E1E4E8" BorderThickness="0,0,1,0" Padding="10,0,10,0">
                                                                <TextBlock Text="{Binding Status}" FontFamily="Consolas" FontSize="14" FontWeight="Bold" Foreground="#1F883D"/>
                                                            </Border>
                                                            <Border Grid.Column="3" Padding="10,0,0,0">
                                                                <TextBlock Text="{Binding Details}" FontFamily="Consolas" FontSize="12" Foreground="#57606A" TextWrapping="Wrap"/>
                                                            </Border>
                                                        </Grid>
                                                    </Border>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                    </StackPanel>
                                </Border>
                            </ScrollViewer>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </ScrollViewer>
        </Border>
        </DockPanel>
        
        <!-- Table Selection Popup - Full Window Overlay -->
        <Border IsVisible="{Binding IsTableSelectionPopupOpen}"
                Background="#CC000000"
                ZIndex="1000">
            <Grid HorizontalAlignment="Center" VerticalAlignment="Center">
                <Border Background="#F8FAFC"
                        CornerRadius="8"
                        BorderBrush="#E2E8F0"
                        BorderThickness="1"
                        Padding="20"
                        MinWidth="450"
                        MaxWidth="550"
                        MaxHeight="400"
                        BoxShadow="0 4 12 0 #0F172A20">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        
                        <!-- Header -->
                        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,16">
                            <TextBlock Text="ðŸ“‹" FontSize="24" Margin="0,0,12,0" VerticalAlignment="Center"/>
                            <StackPanel>
                                <TextBlock Text="Select Output Tables" 
                                           FontSize="18" 
                                           FontWeight="Bold" 
                                           Foreground="#2C3E50"/>
                                <TextBlock Text="{Binding SelectedStoredProcedure.DisplayName, StringFormat='Tables for: {0}'}" 
                                           FontSize="12" 
                                           Foreground="#7F8C8D"/>
                            </StackPanel>
                        </StackPanel>
                        
                        <!-- Info -->
                        <TextBlock Grid.Row="1" 
                                   Text="Select the tables you want to export. Only tables associated with the selected stored procedure are shown."
                                   TextWrapping="Wrap"
                                   FontSize="12"
                                   Foreground="#6C757D"
                                   Margin="0,0,0,16"/>
                        
                        <!-- Table List -->
                        <Border Grid.Row="2" 
                                CornerRadius="8" 
                                BorderBrush="#E1E5E9" 
                                BorderThickness="1" 
                                Background="#FAFBFC">
                            <ScrollViewer MaxHeight="250">
                                <ItemsControl ItemsSource="{Binding AvailableOutputTables}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Background="Transparent"
                                                    Padding="12,8"
                                                    Margin="4,2">
                                                <Border.Styles>
                                                    <Style Selector="Border:pointerover">
                                                        <Setter Property="Background" Value="#F0F8FF"/>
                                                        <Setter Property="CornerRadius" Value="6"/>
                                                    </Style>
                                                </Border.Styles>
                                                <CheckBox Content="{Binding DisplayName}" 
                                                          IsChecked="{Binding IsSelected, Mode=TwoWay}"
                                                          FontSize="13"
                                                          FontWeight="Medium"/>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </ScrollViewer>
                        </Border>
                        
                        <!-- Buttons -->
                        <StackPanel Grid.Row="3" 
                                    Orientation="Horizontal" 
                                    HorizontalAlignment="Right" 
                                    Spacing="12" 
                                    Margin="0,16,0,0">
                            <Button Content="Cancel"
                                    Command="{Binding CloseTableSelectionPopupCommand}"
                                    Classes="secondary-button"
                                    MinWidth="100"/>
                            <Button Content="âœ“ Done"
                                    Command="{Binding CloseTableSelectionPopupCommand}"
                                    Classes="primary-button"
                                    MinWidth="100"/>
                        </StackPanel>
                    </Grid>
                </Border>
            </Grid>
        </Border>
    </Grid>

</Window>
